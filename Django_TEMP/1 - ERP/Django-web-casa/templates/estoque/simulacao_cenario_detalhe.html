{% extends 'base_dashboard.html' %}
{% load i18n %}

{% block title %}Simulação: {{ cenario.nome }}{% endblock %}

{% block sidebar %}
  {% include 'partials/sidebar_admin.html' %}
{% endblock %}

{% block main_content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Simulação: {{ cenario.nome }}</h1>
    <a href="{% url 'gerenciar_estoque' %}" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i>Voltar para Gerenciar Estoque</a>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <p class="mb-2"><strong>Descrição:</strong> {{ cenario.descricao|default:"Sem descrição." }}</p>
      <h4 class="text-success"><strong>Custo Total Estimado: R$ {{ cenario.custo_total|floatformat:"2g" }}</strong></h4>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-header"><h5><i class="fas fa-plus-circle me-2"></i>Adicionar Item Cotado</h5></div>
        <div class="card-body">
          <form method="post" action="{% url 'simulacao_cenario_detalhe' pk=cenario.pk %}">
            {% csrf_token %}
            {{ form_item.as_p }}
            <button type="submit" class="btn btn-primary w-100 mt-3">Adicionar ao Cenário</button>
          </form>
        </div>
      </div>
    </div>
    
    <div class="col-lg-8 mb-4">
      <div class="card">
        <div class="card-header"><h5><i class="fas fa-list-ul me-2"></i>Itens no Cenário</h5></div>
        <div class="card-body">
          <table id="tabela-itens-simulacao" class="table table-striped table-bordered" style="width:100%">
            <thead><tr><th>Item</th><th>Loja</th><th>Preço Est.</th><th>Qtd.</th><th>Subtotal</th><th>Ações</th></tr></thead>
            <tbody>
              {% for item in itens %}
              <tr>
                <td>{{ item.nome_item }}</td>
                <td>{{ item.loja_cotada|default:"N/A" }}</td>
                <td>R$ {{ item.preco_estimado|floatformat:"2g" }}</td>
                <td>{{ item.quantidade }}</td>
                <td>R$ {{ item.subtotal|floatformat:"2g" }}</td>
                <td>
                    <button class="btn btn-primary btn-sm" title="Editar"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger btn-sm" title="Excluir"><i class="fas fa-trash"></i></button>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="6" class="text-center text-muted py-4">Nenhum item adicionado a este cenário ainda.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#tabela-itens-simulacao').DataTable({
        language: { url: 'https://cdn.datatables.net/plug-ins/2.0.8/i18n/pt-BR.json' },
        "order": []
    });
});
</script>
{% endblock %}