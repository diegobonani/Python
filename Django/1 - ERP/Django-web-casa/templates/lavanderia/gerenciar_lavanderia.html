{% extends "base.html" %} 
{% load static %}
{% load i18n %}

{% block title %}Gerenciar Lavanderia{% endblock %}

{% block content %}
<div class="d-flex" style="min-height: 100vh;">
    
    <div class="flex-shrink-0 bg-dark" style="width: 280px;">
        {% include 'partials/sidebar_admin.html' %}
    </div>

    <div class="flex-grow-1 bg-light" style="overflow-y: auto; max-height: 100vh;">
        <div class="container-fluid p-4">
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="h3 mb-0 text-gray-800"><i class="fas fa-tshirt me-2 text-info"></i>Gerenciar Lavanderia</h2>
                    <span class="text-muted small">Controle de cestos, ciclos de lavagem e produtos.</span>
                </div>
                <div class="date-display text-muted bg-white px-3 py-2 rounded shadow-sm border">
                    <i class="far fa-calendar-alt me-2 text-primary"></i> {% now "d \d\e F \d\e Y" %}
                </div>
            </div>

            <div class="mb-4">
                {% if previsao_diaria.erro %}
                    <div class="alert alert-warning border-0 shadow-sm">
                        <i class="fas fa-exclamation-triangle me-2"></i> {{ previsao_diaria.erro }}
                    </div>
                {% else %}
                    <h6 class="text-uppercase text-muted fw-bold small mb-2"><i class="fas fa-cloud-sun me-1"></i> Previsão para Secagem</h6>
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3">
                        {% for dia in previsao_diaria %}
                        <div class="col">
                            <div class="card h-100 border-0 shadow-sm text-center {% if dia.chuva_prob > 50 %}bg-light border-warning{% endif %}">
                                <div class="card-header bg-white border-bottom-0 pt-3 pb-0 fw-bold text-dark">
                                    {{ dia.dia_semana }} <span class="small text-muted fw-normal">({{ dia.data|date:"d/m" }})</span>
                                </div>
                                <div class="card-body p-2">
                                    <div class="display-6 my-1">{{ dia.icone|safe }}</div>
                                    <h5 class="card-title fw-bold mb-0">{{ dia.temp_max }}°C</h5>
                                    <p class="card-text small text-muted text-truncate mb-1">{{ dia.descricao }}</p>
                                    
                                    {% if dia.chuva_prob > 0 %}
                                        <span class="badge rounded-pill {% if dia.chuva_prob > 50 %}bg-warning text-dark{% else %}bg-info text-white{% endif %}">
                                            <i class="fas fa-umbrella me-1"></i> {{ dia.chuva_prob }}%
                                        </span>
                                    {% else %}
                                        <span class="badge rounded-pill bg-success bg-opacity-25 text-success">
                                            <i class="fas fa-sun me-1"></i> Seca Rápido
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="card shadow mb-4 border-0">
                
                <div class="card-header py-0 bg-white border-bottom-0 pt-3">
                    <ul class="nav nav-tabs card-header-tabs" id="lavanderiaTab" role="tablist">
                        
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active fw-bold" id="ciclos-tab" data-bs-toggle="tab" data-bs-target="#ciclos-tab-pane" type="button" role="tab" aria-selected="true"
                                    style="color: #0dcaf0;">
                                <i class="fas fa-tasks me-2"></i>Painel de Controle
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link fw-bold text-secondary" id="historico-tab" data-bs-toggle="tab" data-bs-target="#historico-tab-pane" type="button" role="tab" aria-selected="false">
                                <i class="fas fa-history me-2"></i>Histórico de Ciclos
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="card-body bg-light">
                    <div class="tab-content" id="lavanderiaTabContent">
                        
                        <div class="tab-pane fade show active" id="ciclos-tab-pane" role="tabpanel" aria-labelledby="ciclos-tab">
                            <div id="ciclos-container" class="bg-white rounded shadow-sm border p-0">
                                <div class="text-center p-5">
                                    <div class="spinner-border text-info" role="status"></div>
                                    <p class="mt-2 text-muted">Carregando Painel de Lavanderia...</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="historico-tab-pane" role="tabpanel" aria-labelledby="historico-tab">
                            <div id="historico-container" class="bg-white rounded shadow-sm border p-0">
                                <div class="text-center p-5">
                                    <div class="spinner-border text-secondary" role="status"></div>
                                    <p class="mt-2 text-muted">Carregando Histórico...</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Configuração de URLs para o arquivo JS externo
    window.URL_ABA_CICLOS = "{% url 'lavanderia:aba_ciclos_hoje_partial' %}";
    window.URL_ABA_HISTORICO = "{% url 'lavanderia:aba_historico_lavanderia_partial' %}";
    
    // URLs de CRUD (com 0 como placeholder de PK, substituído pelo JS)
    window.URL_CESTO_JSON = "{% url 'lavanderia:cesto_detalhes_json' pk=0 %}";
    window.URL_CESTO_EDITAR = "{% url 'lavanderia:cesto_editar' pk=0 %}";
    window.URL_CESTO_EXCLUIR = "{% url 'lavanderia:cesto_excluir' pk=0 %}";
    window.URL_AVANCAR_ETAPA = "{% url 'lavanderia:avancar_etapa_ciclo' pk=0 %}";
    window.URL_REMOVER_PRODUTO = "{% url 'lavanderia:remover_produto_ciclo' pk=0 %}";

    // Configuração Global do DataTables
    window.DATATABLES_LANGUAGE_URL = "https://cdn.datatables.net/plug-ins/2.0.8/i18n/pt-BR.json";

    // Script simples para alternar cor da aba ativa (opcional, para visual)
    document.querySelectorAll('#lavanderiaTab button').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function (event) {
            document.querySelectorAll('#lavanderiaTab button').forEach(t => {
                t.style.color = '#6c757d'; // Reset cor secundária
                t.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if(event.target.id === 'ciclos-tab') {
                event.target.style.color = '#0dcaf0'; // Azul Cyan
            } else {
                event.target.style.color = '#0d6efd'; // Azul Primary
            }
        })
    });
</script>

<script src="{% static 'js/gerenciar_lavanderia.js' %}"></script>
{% endblock %}